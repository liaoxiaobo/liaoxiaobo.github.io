<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="liaoxb&#39;s blog">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="liaoxb&#39;s blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="liaoxb">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/2/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>liaoxb's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">liaoxb's blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">liaoxb</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/07/07/linux-shell/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liaoxb">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liaoxb's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | liaoxb's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/07/07/linux-shell/" class="post-title-link" itemprop="url">Linux Shell编程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-07-07 00:36:25" itemprop="dateCreated datePublished" datetime="2018-07-07T00:36:25+08:00">2018-07-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Linux-Shell"><a href="#Linux-Shell" class="headerlink" title="Linux Shell"></a>Linux Shell</h1><p>Shell是这样的一个命令行工具（也称为终端或壳），充当的是人与内核之间的翻译官，用户把一些命令“告诉”终端，它就会调用相应的程序服务去完成某些工作。</p>
<h2 id="Bash-shell-功能"><a href="#Bash-shell-功能" class="headerlink" title="Bash shell 功能"></a>Bash shell 功能</h2><p>主流Linux系统选择Bash（Bourne-Again SHell）作为默认的Shell主要有以下4项优势</p>
<p><strong>1、命令记忆功能</strong></p>
<ul>
<li>通过上下方向键来调取过往执行过的Linux命令；</li>
<li>~&#x2F;.bash_history 记录的是前一次登陆以前所执行过的指令，而至于这一次登陆所执行的指令都被暂存在内存中，当用户成功登出系统后，该指令记忆才会记录到 .bash_history 当中</li>
</ul>
<p><strong>2、Tab键自动补全命令或文件</strong></p>
<p><strong>3、命令别名设置功能（alias）</strong></p>
<p><strong>4：程序化脚本（shell scripts）</strong></p>
<img src="/2018/07/07/linux-shell/output-1737428425946-1.png"  alt="output" style="zoom: 25%;" />

<h2 id="Shell-变量"><a href="#Shell-变量" class="headerlink" title="Shell 变量"></a>Shell 变量</h2><p><strong>变量的设置规则：</strong></p>
<ol>
<li>变量名由字母、数字、下划线组成，不能以数字开头。变量名一般习惯用大写</li>
<li>等号两侧不能有空格</li>
<li>变量值若有空白字符，可使用双引号或单引号将变量内容结合起来<ul>
<li>双引号内的特殊字符如 $ 等，可以保有原本的特性</li>
<li>单引号内的特殊字符则仅为一般字符（纯文本）</li>
</ul>
</li>
<li>反斜杠\ 可以将后面的特殊符号（如 [Enter], $, , 空白字符, ‘等）变成一般字符串</li>
<li>反引号&#96;&#96; 或$()可以将其中的命令执行后返回结果</li>
<li>若该变量需要在其他子程序执行，则需要以 export 来使变量变成环境变量： <code>export PATH</code></li>
</ol>
<p><strong>变量基本操作：</strong></p>
<ol>
<li>查看所有环境变量：<code>env</code></li>
<li>查看单个变量：<code>echo $PATH</code>、<code>echo $&#123;HOME&#125;</code></li>
<li>定义变量：<code>变量名=变量值</code></li>
<li>删除变量：<code>unset 变量名</code> </li>
<li>特殊符号变量：<ul>
<li>$$：当前进程的 PID 进程号</li>
<li>$?：上个命令执行的回传值，0为执行成功，非0执行失败</li>
<li>$0：脚本文件名称</li>
<li>$#：脚本的参数个数</li>
<li>$@：代表 「<code>&quot;&amp;1&quot; &quot;&amp;2&quot; &quot;&amp;3&quot; &quot;&amp;4&quot;</code>」 的意思，每个变量是独立的（用双引号括起来）</li>
</ul>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 示例1：使用反斜杠（\）进行转义</span></span><br><span class="line">[root@linuxprobe ~]# PRICE=5</span><br><span class="line">[root@linuxprobe ~]# <span class="built_in">echo</span> <span class="string">&quot;Price is \$<span class="variable">$PRICE</span>&quot;</span></span><br><span class="line">Price is <span class="variable">$5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例2:将一个命令的执行结果赋值给变量（重点）</span></span><br><span class="line">[root@node-1 ~]# A=`<span class="built_in">date</span>`</span><br><span class="line">[root@node-1 ~]# <span class="built_in">echo</span> <span class="variable">$A</span></span><br><span class="line">2021年 12月 14日 星期二 01:22:02 CST</span><br><span class="line"></span><br><span class="line">[root@node-1 ~]# A=$(<span class="built_in">date</span>)</span><br><span class="line">[root@node-1 ~]# <span class="built_in">echo</span> <span class="variable">$A</span></span><br><span class="line">2021年 12月 14日 星期二 01:25:22 CST</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例3:单引号和双引号的使用区别</span></span><br><span class="line">[root@node-1 ~]# NAME=<span class="string">&#x27;liao xiaobo&#x27;</span></span><br><span class="line">[root@node-1 ~]# NAME=<span class="string">&quot;My name is <span class="variable">$NAME</span>&quot;</span>	<span class="comment"># 双引号会保留特殊符号的含义</span></span><br><span class="line">[root@node-1 ~]# <span class="built_in">echo</span> <span class="variable">$NAME</span></span><br><span class="line">My name is liao xiaobo</span><br><span class="line"></span><br><span class="line">[root@node-1 ~]# NAME2=<span class="string">&#x27;My name is $NAME&#x27;</span>	<span class="comment"># 单引号之间的内容原封不动的指定给了变量；</span></span><br><span class="line">[root@node-1 ~]# <span class="built_in">echo</span> <span class="variable">$NAME2</span></span><br><span class="line">My name is <span class="variable">$NAME</span></span><br></pre></td></tr></table></figure>

<h2 id="Bash-的环境配置文件"><a href="#Bash-的环境配置文件" class="headerlink" title="Bash 的环境配置文件"></a>Bash 的环境配置文件</h2><p>bash 配置文件的读入方式是通过 source 指令来读取的。</p>
<p>整个 login shell 的读取流程如下：</p>


<p> <code>/etc/profile</code>：这是系统整体的设置，一般不需要修改这个文件；</p>
<p><code>~/.bash_profile</code> 或 <code>~/.bash_login</code>：属于登陆用户的个人设置</p>
<h2 id="输入输出重定向"><a href="#输入输出重定向" class="headerlink" title="输入输出重定向"></a>输入输出重定向</h2><p>简而言之，输入重定向是指把文件导入到命令中，而输出重定向则是指把原本要输出到屏幕的数据信息写入到指定文件中。</p>
<p>在日常的学习和工作中，相较于输入重定向，我们使用输出重定向的频率更高，输出重定向分为标准输出重定向和错误输出重定向两种不同的技术，以及清空写入与追加写入两种模式。</p>
<p>输入重定向中用到的符号及其作用</p>
<table>
<thead>
<tr>
<th>符号</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>命令 &lt; 文件</td>
<td>将文件作为命令的标准输入</td>
</tr>
<tr>
<td>命令 &lt;&lt; 分界符</td>
<td>从标准输入中读入，直到遇见分界符才停止</td>
</tr>
<tr>
<td>命令 &lt; 文件1 &gt; 文件2</td>
<td>将文件1作为命令的标准输入并将标准输出到文件2</td>
</tr>
</tbody></table>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 远程执行本地shell脚本</span></span><br><span class="line">ssh master02 <span class="string">&#x27;bash -s&#x27;</span>&lt; /opt/kill.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等同于cat admin-openrc.sh | wc -l的管道符命令组合</span></span><br><span class="line">[root@master01 ~]# <span class="built_in">wc</span> -l &lt; admin-openrc.sh</span><br><span class="line">11</span><br></pre></td></tr></table></figure>

<p>输出重定向中用到的符号及其作用</p>
<table>
<thead>
<tr>
<th>符号</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>命令 &gt; 文件</td>
<td>将标准输出重定向到一个文件中（清空）</td>
</tr>
<tr>
<td>命令 2&gt; 文件</td>
<td>将错误输出重定向到一个文件中（清空）</td>
</tr>
<tr>
<td>命令 &gt;&gt; 文件</td>
<td>将标准输出重定向到一个文件中（追加）</td>
</tr>
<tr>
<td>命令 2&gt;&gt; 文件</td>
<td>将错误输出重定向到一个文件中（追加）</td>
</tr>
<tr>
<td>命令 &gt;&gt; 文件 2&gt;&amp;1 或 命令 &amp;&gt;&gt; 文件</td>
<td>将标准输出与错误输出共同写入到文件中（追加）</td>
</tr>
</tbody></table>
<h2 id="常用判断式"><a href="#常用判断式" class="headerlink" title="常用判断式"></a>常用判断式</h2><h3 id="文件判断（类型、权限）"><a href="#文件判断（类型、权限）" class="headerlink" title="文件判断（类型、权限）"></a>文件判断（类型、权限）</h3><table>
<thead>
<tr>
<th align="center">测试的标志</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-e</td>
<td align="left">文件是否存在；<strong>常用</strong></td>
</tr>
<tr>
<td align="center">-f</td>
<td align="left">该文件是否存在且为文件（file）？<strong>常用</strong></td>
</tr>
<tr>
<td align="center">-d</td>
<td align="left">该文件是否存在且为目录（directory）？<strong>常用</strong></td>
</tr>
<tr>
<td align="center">-b</td>
<td align="left">该文件是否存在且为一个 block device ？</td>
</tr>
<tr>
<td align="center">-r</td>
<td align="left">该文件是否存在且具有可读权限？</td>
</tr>
<tr>
<td align="center">-w</td>
<td align="left">该文件是否存在且具有可写权限？</td>
</tr>
<tr>
<td align="center">-x</td>
<td align="left">该文件是否存在且具有可执行权限？</td>
</tr>
<tr>
<td align="center">-ef</td>
<td align="left">判断 file1 与 file2 是否是同一文件，可用在判断 hard link 的判定上。主要意义在判定两个文件是否均指向同一个 inode</td>
</tr>
</tbody></table>
<h3 id="整数比较"><a href="#整数比较" class="headerlink" title="整数比较"></a>整数比较</h3><p>整数比较运算符仅是对数字的操作，不能将数字与字符串、文件等内容一起操作，而且不能想当然地使用日常生活中的等号、大于号、小于号等来判断。</p>
<table>
<thead>
<tr>
<th align="center">测试的标志</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-eq</td>
<td align="left">两数值相等（equal）</td>
</tr>
<tr>
<td align="center">-ne</td>
<td align="left">不相等（not equal）</td>
</tr>
<tr>
<td align="center">-gt</td>
<td align="left">大于（greater than）</td>
</tr>
<tr>
<td align="center">-lt</td>
<td align="left">小于（less than）</td>
</tr>
<tr>
<td align="center">-ge</td>
<td align="left">大于等于（greater than or equal）</td>
</tr>
<tr>
<td align="center">-le</td>
<td align="left">小于等于（less than or equal）</td>
</tr>
</tbody></table>
<h3 id="字符串比较"><a href="#字符串比较" class="headerlink" title="字符串比较"></a>字符串比较</h3><table>
<thead>
<tr>
<th align="center">测试的标志</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-z string</td>
<td align="left">判定字符串是否为 0？若为空串，则为 true</td>
</tr>
<tr>
<td align="center">-n string</td>
<td align="left">判定字符串是否不为 0？若为空串，则为 false；注意：-n 可省略</td>
</tr>
<tr>
<td align="center">str1 &#x3D;&#x3D; str2</td>
<td align="left">是否相等，相等则为 true</td>
</tr>
<tr>
<td align="center">str1 !&#x3D; str2</td>
<td align="left">是否不相等，相等则为 false</td>
</tr>
</tbody></table>
<h3 id="逻辑判断"><a href="#逻辑判断" class="headerlink" title="逻辑判断"></a>逻辑判断</h3><table>
<thead>
<tr>
<th align="center">测试的标志</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-a</td>
<td align="left">（and）两状况同时成立；如：<code>test -r filename -a -x filename</code>，则 file 同时具有 r 与 x 权限时才为 true</td>
</tr>
<tr>
<td align="center">-o</td>
<td align="left">（or）任意一个成立。如：<code>test -r filename -o -x filename</code>，则 file 具有 r 或 x 权限时就为 true</td>
</tr>
<tr>
<td align="center">!</td>
<td align="left">反向状态</td>
</tr>
</tbody></table>
<h2 id="脚本执行方式差异"><a href="#脚本执行方式差异" class="headerlink" title="脚本执行方式差异"></a>脚本执行方式差异</h2><p><strong>.&#x2F;script 或者 sh script执行</strong>：运行脚本时都会使用一个新的 bash 环境，即子程序的 bash 内执行。当子程序完成后，子程序内的各项变量或动作将会结束，不会传回到父程序中。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 运行上面范例的姓名打印</span></span><br><span class="line">[mrcode@study bin]$ ./showname.sh </span><br><span class="line">Please input you first name: m</span><br><span class="line">Please input you last name: q</span><br><span class="line"></span><br><span class="line"> Your full name is: mq		<span class="comment">#  echo -e &quot;\n Your full name is: $&#123;firstname&#125;$&#123;lastname&#125;&quot; 打印出来了信息</span></span><br><span class="line">[mrcode@study bin]$ <span class="built_in">echo</span> <span class="variable">$&#123;fristname&#125;</span><span class="variable">$&#123;lastname&#125;</span>		<span class="comment"># 但是在父程序中却没有信息</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>source 执行</strong>：同样的测试代码，使用 source 则会在父程序中执行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[mrcode@study bin]$ <span class="built_in">source</span> showname.sh </span><br><span class="line">Please input you first name: m</span><br><span class="line">Please input you last name: q</span><br><span class="line"></span><br><span class="line"> Your full name is: mq</span><br><span class="line">[mrcode@study bin]$ <span class="built_in">echo</span> <span class="variable">$&#123;firstname&#125;</span><span class="variable">$&#123;lastname&#125;</span></span><br><span class="line">mq			<span class="comment"># 在父程序中还能获取到</span></span><br></pre></td></tr></table></figure>

<h2 id="脚本练习"><a href="#脚本练习" class="headerlink" title="脚本练习"></a>脚本练习</h2><h3 id="利用-date-进行文件的建立"><a href="#利用-date-进行文件的建立" class="headerlink" title="利用 date 进行文件的建立"></a>利用 date 进行文件的建立</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Program: </span></span><br><span class="line"><span class="comment">#       用户输入文件名前缀，生成前天、昨天、今天的三个空文件</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;将使用 ‘touch’ 命令创建 3 个文件&quot;</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;请输入文件名：&quot;</span> fileuser</span><br><span class="line"></span><br><span class="line"><span class="comment"># 容错，使用变量功能判定与赋值默认值</span></span><br><span class="line">filename=<span class="variable">$&#123;fileuser:-&quot;filename&quot;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># date 命令的使用</span></span><br><span class="line">date1=$(<span class="built_in">date</span> --<span class="built_in">date</span>=<span class="string">&#x27;2 days ago&#x27;</span> +%Y-%m-%d)		<span class="comment"># 两天前的日期，并格式化显示</span></span><br><span class="line">date2=$(<span class="built_in">date</span> --<span class="built_in">date</span>=<span class="string">&#x27;1 days ago&#x27;</span> +%Y-%m-%d)	</span><br><span class="line">date3=$(<span class="built_in">date</span> +%Y-%m-%d)</span><br><span class="line"></span><br><span class="line">file1=<span class="string">&quot;<span class="variable">$&#123;filename&#125;</span>_<span class="variable">$&#123;date1&#125;</span>&quot;</span></span><br><span class="line">file2=<span class="string">&quot;<span class="variable">$&#123;filename&#125;</span>_<span class="variable">$&#123;date2&#125;</span>&quot;</span></span><br><span class="line">file3=<span class="string">&quot;<span class="variable">$&#123;filename&#125;</span>_<span class="variable">$&#123;date3&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在这里其实可以直接拼接文件名</span></span><br><span class="line"><span class="built_in">touch</span> <span class="string">&quot;<span class="variable">$&#123;file1&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">touch</span> <span class="string">&quot;<span class="variable">$&#123;file2&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">touch</span> <span class="string">&quot;<span class="variable">$&#123;file3&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="数值运算：简单的加减乘除"><a href="#数值运算：简单的加减乘除" class="headerlink" title="数值运算：简单的加减乘除"></a>数值运算：简单的加减乘除</h3><p>在Linux变量中，需要使用 <code>declare</code>来定义变量为正数才能进行计算，此外，也可以利用 <code>$((计算表达式))</code> 来进行数值运算，可惜的是，bashe shell 预设仅支持整数数据。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Program:</span></span><br><span class="line"><span class="comment">#       用户输入 2 个整数；输出相乘后的结果</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&#x27;请输入第一个整数：&#x27;</span> intUser1</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&#x27;请输入第二个整数：&#x27;</span> intUser2</span><br><span class="line"><span class="built_in">declare</span> -i int1=<span class="variable">$&#123;intUser1&#125;</span></span><br><span class="line"><span class="built_in">declare</span> -i int2=<span class="variable">$&#123;intUser2&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e  <span class="string">&quot;\n <span class="variable">$&#123;int1&#125;</span> x <span class="variable">$&#123;int2&#125;</span> = <span class="subst">$((int1*int2)</span>)&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="多重、复杂条件判断"><a href="#多重、复杂条件判断" class="headerlink" title="多重、复杂条件判断"></a>多重、复杂条件判断</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Program:</span></span><br><span class="line"><span class="comment">#       直接携带参数提示</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> == <span class="string">&quot;hello&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;Hello, how ary you?&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ -z <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;请携带参数&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;只能携带参数 hello&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h3 id="利用-case-esac-判断"><a href="#利用-case-esac-判断" class="headerlink" title="利用 case...esac 判断"></a>利用 <code>case...esac</code> 判断</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Program:</span></span><br><span class="line"><span class="comment">#       直接携带参数提示</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">	<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;Hello, how ary you?&quot;</span></span><br><span class="line">	;;</span><br><span class="line">	<span class="string">&quot;&quot;</span>)</span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;请携带参数&quot;</span></span><br><span class="line">	;;</span><br><span class="line">	*)</span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;只能携带参数 hello&quot;</span></span><br><span class="line">	;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/07/01/linux-basic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liaoxb">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liaoxb's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | liaoxb's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/07/01/linux-basic/" class="post-title-link" itemprop="url">Linux 文件系统</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-07-01 20:36:25" itemprop="dateCreated datePublished" datetime="2018-07-01T20:36:25+08:00">2018-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>10k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>9 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Linux-文件与目录管理"><a href="#Linux-文件与目录管理" class="headerlink" title="Linux 文件与目录管理"></a>Linux 文件与目录管理</h1><h2 id="一切皆文件"><a href="#一切皆文件" class="headerlink" title="一切皆文件"></a>一切皆文件</h2><p>“一切皆是文件”是 Unix&#x2F;Linux 的基本哲学之一，它是指 Linux 系统中的所有的一切都可以通过文件的方式访问、管理，即使不是文件，也以文件的形式来管理。例如硬件设备、进程、套接字等都抽象成伪文件，使用统一的用户接口，虽然文件类型各不相同，但是对其提供的却是同一套操作。</p>
<p>在 Linux 中共有 7 种类型的文件，使用了不同的字符来加以区分，其中伪文件并不占用磁盘空间：</p>
<table>
<thead>
<tr>
<th>文件类型标识</th>
<th>文件类型</th>
</tr>
</thead>
<tbody><tr>
<td><code>-</code></td>
<td>普通文件</td>
</tr>
<tr>
<td><code>d</code></td>
<td>目录文件</td>
</tr>
<tr>
<td><code>l</code></td>
<td>符号链接</td>
</tr>
<tr>
<td><code>c</code>（伪文件）</td>
<td>字符设备（character device）</td>
</tr>
<tr>
<td><code>b</code>（伪文件）</td>
<td>块设备（block device）</td>
</tr>
<tr>
<td><code>s</code>（伪文件）</td>
<td>套接字文件（socket）</td>
</tr>
<tr>
<td><code>p</code>（伪文件）</td>
<td>命名管道文件（pipe）</td>
</tr>
</tbody></table>
<h2 id="硬件设备命名"><a href="#硬件设备命名" class="headerlink" title="硬件设备命名"></a>硬件设备命名</h2><p>系统内核中的udev设备管理器会自动把硬件名称规范起来，目的是让用户通过设备文件的名字可以猜出设备大致的属性以及分区信息等；这对于陌生的设备来说特别方便。</p>
<table>
<thead>
<tr>
<th>硬件设备</th>
<th>文件名称</th>
</tr>
</thead>
<tbody><tr>
<td>SCSI&#x2F;SATA&#x2F;U盘</td>
<td>&#x2F;dev&#x2F;sd[a-z]</td>
</tr>
<tr>
<td>virtio设备</td>
<td>&#x2F;dev&#x2F;vd[a-z]（用于虚拟机内）</td>
</tr>
<tr>
<td>软驱</td>
<td>&#x2F;dev&#x2F;fd[0-7]</td>
</tr>
<tr>
<td>打印机</td>
<td>&#x2F;dev&#x2F;lp[0-15]</td>
</tr>
<tr>
<td>光驱CDROM</td>
<td>&#x2F;dev&#x2F;sr[0-1] （通用，CentOS 较常见）&#x2F;dev&#x2F;cdrom （当前 CDROM）</td>
</tr>
<tr>
<td>鼠标</td>
<td>&#x2F;dev&#x2F;mouse</td>
</tr>
<tr>
<td>磁带机</td>
<td>&#x2F;dev&#x2F;st0或&#x2F;dev&#x2F;ht0</td>
</tr>
</tbody></table>
<h2 id="文件权限与属性"><a href="#文件权限与属性" class="headerlink" title="文件权限与属性"></a>文件权限与属性</h2><p>文件的读、写、执行权限可以简写为rwx，亦可分别用数字4、2、1来表示，文件所有者，所属组及其他用户权限之间无关联。</p>
<img src="/2018/07/01/linux-basic/1737019312867-1.png" class="" title="img">

<p>在上图中，包含了文件的类型、访问权限、所有者（属主）、所属组（属组）、占用的磁盘大小、修改时间和文件名称等信息。</p>
<p>通过分析可知，该文件类型为普通文件，所有者权限为可读、可写（rw-），所属组权限为可读（r–），除此以外的其他人也只有可读权限（r–），文件的磁盘占用大小是34298字节，最近一次的修改时间为4月2日的凌晨23分，文件的名称为install.log。</p>
<h2 id="目录树结构"><a href="#目录树结构" class="headerlink" title="目录树结构"></a>目录树结构</h2><p>在Windows操作系统中，想要找到一个文件，要依次进入该文件所在的磁盘分区（也叫盘符），然后再进入该分区下的具体目录，最终找到这个文件。但是在Linux系统中并不存在C、D、E、F等盘符，<strong>Linux系统中的一切文件都是从“根”目录（&#x2F;）开始的，并按照文件系统层次标准(FHS)采用倒树状结构来存放文件，以及定义了常见目录的用途。</strong></p>
<img src="/2018/07/01/linux-basic/linux-file-system-directory.png"  alt="img" style="zoom: 50%;" />

<p>Linux系统中常见的目录名称以及相应内容</p>
<table>
<thead>
<tr>
<th>目录名称</th>
<th>应放置文件的内容</th>
</tr>
</thead>
<tbody><tr>
<td>&#x2F;boot</td>
<td>开机所需文件—内核、开机菜单以及所需配置文件等</td>
</tr>
<tr>
<td>&#x2F;dev</td>
<td>以文件形式存放任何设备与接口</td>
</tr>
<tr>
<td>&#x2F;etc</td>
<td>配置文件</td>
</tr>
<tr>
<td>&#x2F;home</td>
<td>用户主目录</td>
</tr>
<tr>
<td>&#x2F;bin</td>
<td>存放单用户模式下还可以操作的[命令]</td>
</tr>
<tr>
<td>&#x2F;lib</td>
<td>开机时用到的函数库，以及&#x2F;bin与&#x2F;sbin下面的命令要调用的函数</td>
</tr>
<tr>
<td>&#x2F;sbin</td>
<td>开机过程中需要的命令</td>
</tr>
<tr>
<td>&#x2F;media</td>
<td>用于挂载设备文件的目录</td>
</tr>
<tr>
<td>&#x2F;opt</td>
<td>放置第三方的软件</td>
</tr>
<tr>
<td>&#x2F;root</td>
<td>系统管理员的家目录</td>
</tr>
<tr>
<td>&#x2F;srv</td>
<td>一些网络服务的数据文件目录</td>
</tr>
<tr>
<td>&#x2F;tmp</td>
<td>任何人均可使用的“共享”临时目录</td>
</tr>
<tr>
<td>&#x2F;proc</td>
<td>虚拟文件系统，例如系统内核、进程、外部设备及网络状态等</td>
</tr>
<tr>
<td>&#x2F;usr&#x2F;local</td>
<td>用户自行安装的软件</td>
</tr>
<tr>
<td>&#x2F;usr&#x2F;sbin</td>
<td>Linux系统开机时不会使用到的软件&#x2F;命令&#x2F;[脚本]</td>
</tr>
<tr>
<td>&#x2F;usr&#x2F;share</td>
<td>帮助与说明文件，也可放置共享文件</td>
</tr>
<tr>
<td>&#x2F;var</td>
<td>主要存放经常变化的文件，如日志</td>
</tr>
<tr>
<td>&#x2F;lost+found</td>
<td>当文件系统发生错误时，将一些丢失的文件片段存放在这里</td>
</tr>
</tbody></table>
<h1 id="Linux-硬盘与文件系统管理"><a href="#Linux-硬盘与文件系统管理" class="headerlink" title="Linux 硬盘与文件系统管理"></a>Linux 硬盘与文件系统管理</h1><h2 id="硬盘类型"><a href="#硬盘类型" class="headerlink" title="硬盘类型"></a><strong>硬盘类型</strong></h2><img src="/2018/07/01/linux-basic/disk.png"  alt="disk" style="zoom: 50%;" />

<p><strong>机械硬盘</strong>（HDD）的组成主要有盘片、机械手臂、磁头与主轴马达所组成，而数据的写入其实是在盘片上面。盘片上面又可细分出扇区（Sector）与磁道（Track）两种单位，其中扇区的容量设计有两种大小，分别是 512Bytes 与 4KBytes。</p>
<p><strong>固态硬盘</strong>（SSD）是基于半导体闪存（NAND Flash）作为存储介质的硬盘，相比传统的机械硬盘，它去掉了机械固件，引入了主控芯片来代替机械操作，这意味着它的性能、功耗及可靠性会比HDD高出一大截。固态硬盘虽然没有物理扇区，但逻辑上仍保留扇区的概念以兼容操作系统和文件系统。</p>
<p>关于硬盘的总结如下：</p>
<ul>
<li>扇区（Sector）为最小的物理储存单位，且依据磁盘设计的不同，目前主要有 512Bytes与 4K 两种格式；</li>
<li>柱面（cylinder）是由多个盘片上处于同一磁道位置（即同一半径）的磁道组成的集合；</li>
</ul>
<h2 id="硬盘分区和挂载"><a href="#硬盘分区和挂载" class="headerlink" title="硬盘分区和挂载"></a>硬盘分区和挂载</h2><p><strong>分区工具</strong><br>常用的分区工具有 <code>fdisk</code>、<code>parted</code>、Windows 下的磁盘管理工具等。使用这些工具可以在硬盘上建立一个分区表，用于记录每个分区的起始位置、结束位置、大小及其它属性。</p>
<p><strong>分区表类型</strong></p>
<p><strong>MBR（Master Boot Record）</strong>：传统的分区表格式，最多支持4个主分区（或3个主分区加一个扩展分区，扩展分区内可创建多个逻辑分区）。</p>
<p>MBR 分区表中，第一个扇区最重要，里面有主开机记录（Master boot record,MBR）及分区表（partition table），其中 MBR 占有 446 Bytes，而 partition table 则占有 64 Bytes。</p>
<img src="/2018/07/01/linux-basic/1737022182076-13.png"  alt="img" style="zoom: 50%;" />

<p><strong>GPT（GUID Partition Table）</strong>：现代硬盘常用的分区表格式，支持更多分区，且对于大容量硬盘有更好的支持和数据冗余能力。</p>
<p><strong>分区过程</strong><br>分区工具会让你选择起始扇区和结束扇区，从而决定每个分区的大小。现在的分区都是基于逻辑扇区（LBA）进行划分的。</p>
<ul>
<li><strong>指定大小和位置</strong>：用户可以根据需要指定各个分区的大小和位置，确保不同的分区满足不同应用场景的需求。</li>
<li><strong>确定分区类型</strong>：通常会根据用途为分区分配不同的标记或文件系统类型（如Linux下的 ext4、swap 分区，Windows下的 NTFS 等）。</li>
<li><strong>写入分区表</strong>：完成分区配置后，工具会将信息写入硬盘的分区表中。以后系统启动时，就会根据这个分区表来识别和管理各个分区。</li>
</ul>
<p><strong>方法一：分区 → 格式化 → 挂载</strong></p>
<p>使用步骤：</p>
<ol>
<li>输入 <code>n</code> 创建新分区。</li>
<li>输入分区类型（如 <code>primary</code> 或 <code>logical</code>）。</li>
<li>设置起始和结束扇区（通常直接按回车使用默认值）。</li>
<li>输入 <code>w</code> 保存分区表并退出。</li>
<li>格式化分区</li>
<li>挂载分区</li>
<li>开机自动挂载（可选）</li>
</ol>
<img src="/2018/07/01/linux-basic/output.png"  alt="output" style="zoom: 67%;" />

<img src="/2018/07/01/linux-basic/output-1737083379812-9.png" class="" title="output">

<p><strong>方法二：直接格式化→ 挂载</strong></p>
<p>这种方法适合特定用途，例如非系统盘的大容量存储。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> mkfs.ext4 /dev/sdb</span><br><span class="line"><span class="built_in">sudo</span> mount /dev/sdb /mnt/data</span><br></pre></td></tr></table></figure>

<p><strong>方法三：使用 LVM（逻辑卷管理器）</strong></p>
<p>如果需要灵活管理硬盘容量，可以使用 LVM：初始化 → 创建卷组 → 创建逻辑卷 → 格式化 → 挂载</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 初始化硬盘</span></span><br><span class="line"><span class="built_in">sudo</span> pvcreate /dev/sdb</span><br><span class="line"><span class="comment"># 创建卷组</span></span><br><span class="line"><span class="built_in">sudo</span> vgcreate my_vg /dev/sdb</span><br><span class="line"><span class="comment"># 创建逻辑卷</span></span><br><span class="line"><span class="built_in">sudo</span> lvcreate -L 50G -n my_lv my_vg</span><br><span class="line"><span class="comment">#格式化卷</span></span><br><span class="line"><span class="built_in">sudo</span> mkfs.ext4 /dev/my_vg/my_lv</span><br><span class="line"><span class="comment">#挂载卷</span></span><br><span class="line"><span class="built_in">sudo</span> mount /dev/my_vg/my_lv /mnt/data</span><br></pre></td></tr></table></figure>

<p><strong>方法四：作为裸设备使用</strong></p>
<p>某些特殊用途（如数据库或存储系统）可能直接使用裸设备，无需分区和格式化。例如数据库（如 MySQL）可以直接将 <code>/dev/sdb</code> 作为数据存储路径。</p>
<h2 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h2><h3 id="链接文件"><a href="#链接文件" class="headerlink" title="链接文件"></a>链接文件</h3><blockquote>
<p>Unix&#x2F;Linux系统内部不使用文件名，而使用inode号码来识别文件，即系统读取根据 inode号码获取inode信息，分析 inode 所记录的权限与使用者是否符合，若符合才能够读取文件所在block里的数据。</p>
</blockquote>
<p><strong>硬链接</strong></p>
<p>一般情况下，文件名和inode号码是”一一对应”关系，每个inode号码对应一个文件名。但是，Unix&#x2F;Linux系统允许，多个文件名指向同一个inode号码。</p>
<p>这意味着，可以用不同的文件名访问同样的内容；对文件内容进行修改，会影响到所有文件名；但是，删除一个文件名，不影响另一个文件名的访问。这种情况就被称为”硬链接”（hard link）。</p>
<p>使用限制：link不能跨文件系统，也不能 link 目录</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@master01 ~]# ll -i /etc/crontab</span><br><span class="line">268535884 -rw-r--r-- 1 root root 451 Mar 14  2020 /etc/crontab</span><br><span class="line"></span><br><span class="line">[root@master01 ~]# <span class="built_in">ln</span> /etc/crontab .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立硬链接，链接数加1</span></span><br><span class="line">[root@master01 ~]# ll -i /etc/crontab crontab</span><br><span class="line">268535884 -rw-r--r-- 2 root root 451 Mar 14  2020 crontab</span><br><span class="line">268535884 -rw-r--r-- 2 root root 451 Mar 14  2020 /etc/crontab</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除硬链接，链接数减1</span></span><br><span class="line">[root@master01 ~]# <span class="built_in">rm</span> -rf crontab</span><br><span class="line">[root@master01 ~]# ll -i /etc/crontab</span><br><span class="line">268535884 -rw-r--r-- 1 root root 451 Mar 14  2020 /etc/crontab</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>软链接（符号链接）</strong></p>
<p>软链接与硬链接最大的不同：文件A指向文件B的文件名，而不是文件B的inode号码，文件B的inode”链接数”不会因此发生变化。如果删除了文件B，打开文件A就会报错：”No such file or directory”。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master01 ~]# <span class="built_in">ln</span> -s /etc/crontab crontab_test</span><br><span class="line"></span><br><span class="line">[root@master01 ~]# ll -i /etc/crontab crontab_test</span><br><span class="line">344677386 lrwxrwxrwx 1 root root  12 Jan 20 18:41 crontab_test -&gt; /etc/crontab</span><br><span class="line">268535884 -rw-r--r-- 1 root root 451 Mar 14  2020 /etc/crontab</span><br></pre></td></tr></table></figure>

<p>另外，在Linux系统上&#x2F;bin&#x2F;sh通常就是指向&#x2F;bin&#x2F;bash的符号链接。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master01 ~]# ll -i /bin/sh</span><br><span class="line">872423134 lrwxrwxrwx 1 root root 4 Feb 20  2024 /bin/sh -&gt; bash</span><br><span class="line"></span><br><span class="line">[root@master01 ~]# ll -i /bin/bash</span><br><span class="line">872423123 -rwxr-xr-x 1 root root 1166952 Feb 20  2024 /bin/bash</span><br></pre></td></tr></table></figure>

<h3 id="XFS-文件系统"><a href="#XFS-文件系统" class="headerlink" title="XFS 文件系统"></a>XFS 文件系统</h3><p>XFS 是一种高性能的文件系统，相比 ext4，它在某些方面具有显著优势。如下：</p>
<ul>
<li><strong>大文件处理</strong>：XFS 在处理大文件时性能优异，适合需要频繁读写大文件的场景（如视频编辑、数据库）。</li>
<li><strong>高并发</strong>：XFS 通过延迟分配（Delayed Allocation）和分布式 B+ 树索引，优化了高并发写入性能，特别是在多线程场景下，能够更好地利用多核 CPU，适合高并发工作负载。</li>
<li><strong>动态 inode 分配</strong>：XFS 可以动态分配 inode，而 ext4 需要在创建文件系统时预先分配 inode，可能导致 inode 不足和格式化速度慢的问题。</li>
<li><strong>高效的日志机制</strong>：XFS 的日志机制更高效，能够快速恢复文件系统一致性，尤其在系统崩溃后。</li>
</ul>
<h3 id="Proc-文件系统"><a href="#Proc-文件系统" class="headerlink" title="Proc 文件系统"></a>Proc 文件系统</h3><p>Linux 系统上的 &#x2F;proc 目录是一种文件系统，即 proc 文件系统（procfs），它以文件系统的方式为用户提供访问系统内核数据的操作接口。proc 文件系统是一种内核和内核模块用来向进程（process）发送信息的机制，因此被称为 proc。</p>
<p>与其它常见的文件系统不同的是，proc 是一种伪文件系统（也即虚拟文件系统），它只存在于内存当中，因此它会在系统启动时创建并挂载到 &#x2F;proc 目录，在系统关闭时卸载并释放。</p>
<p>下面是linux服务器上 &#x2F;proc 的挂载信息</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master03 ~]# mount |grep proc</span><br><span class="line">proc on /proc <span class="built_in">type</span> proc (rw,nosuid,nodev,noexec,relatime)</span><br><span class="line">systemd-1 on /proc/sys/fs/binfmt_misc <span class="built_in">type</span> autofs (rw,relatime,fd=30,pgrp=1,<span class="built_in">timeout</span>=0,minproto=5,maxproto=5,direct,pipe_ino=104535)</span><br></pre></td></tr></table></figure>

<p>&#x2F;proc 目录中的文件及其说明如下：</p>
<table>
<thead>
<tr>
<th>文件</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>&#x2F;proc&#x2F;buddyinfo</td>
<td>每个内存区中的每个 order 有多少块可用，和内存碎片问题有关。</td>
</tr>
<tr>
<td>&#x2F;proc&#x2F;cmdline</td>
<td>启动时传递给 kernel 的参数信息。</td>
</tr>
<tr>
<td><strong>&#x2F;proc&#x2F;cpuinfo</strong></td>
<td>CPU 信息。</td>
</tr>
<tr>
<td>&#x2F;proc&#x2F;crypto</td>
<td>内核可用的加密模块及细节。</td>
</tr>
<tr>
<td><strong>&#x2F;proc&#x2F;devices</strong></td>
<td>已装载的设备（包括字符设备和块设备）。</td>
</tr>
<tr>
<td><strong>&#x2F;proc&#x2F;diskstats</strong></td>
<td>每个逻辑磁盘设备的信息（包括设备编号） 。</td>
</tr>
<tr>
<td>&#x2F;proc&#x2F;dma</td>
<td>已注册使用的 ISA DMA 通道列表。</td>
</tr>
<tr>
<td>&#x2F;proc&#x2F;execdomains</td>
<td>Linux 内核当前支持的 execution domains。</td>
</tr>
<tr>
<td>&#x2F;proc&#x2F;fb</td>
<td>帧缓冲设备列表，包括数量和控制它的驱动。</td>
</tr>
<tr>
<td><strong>&#x2F;proc&#x2F;filesystems</strong></td>
<td>内核当前支持的文件系统类型。</td>
</tr>
<tr>
<td>&#x2F;proc&#x2F;interrupts</td>
<td>当前系统使用的中断信息。</td>
</tr>
<tr>
<td>&#x2F;proc&#x2F;iomem</td>
<td>每个物理设备当前在系统内存中的映射。</td>
</tr>
<tr>
<td>&#x2F;proc&#x2F;ioports</td>
<td>一个设备的输入输出所使用的注册端口范围。</td>
</tr>
<tr>
<td>&#x2F;proc&#x2F;kcore</td>
<td>代表系统的物理内存，存储为核心文件格式。</td>
</tr>
<tr>
<td>&#x2F;proc&#x2F;kmsg</td>
<td>等待内核输出信息，可以通过 &#x2F;sbin&#x2F;klogd 或 &#x2F;bin&#x2F;dmesg 来处理。</td>
</tr>
<tr>
<td>&#x2F;proc&#x2F;loadavg</td>
<td>依据过去一段时间内 CPU 和 IO 的状态得出的负载形态，与 uptime 命令有关。</td>
</tr>
<tr>
<td>&#x2F;proc&#x2F;locks</td>
<td>内核锁住的文件列表。</td>
</tr>
<tr>
<td>&#x2F;proc&#x2F;mdstat</td>
<td>多硬盘，RAID 配置信息（md&#x3D;multiple disks）。</td>
</tr>
<tr>
<td><strong>&#x2F;proc&#x2F;meminfo</strong></td>
<td>内核管理内存的信息。</td>
</tr>
<tr>
<td>&#x2F;proc&#x2F;misc</td>
<td>在杂项设备（设备号为10）上注册的驱动。</td>
</tr>
<tr>
<td><strong>&#x2F;proc&#x2F;modules</strong></td>
<td>所有装载到内核的模块列表。</td>
</tr>
<tr>
<td>&#x2F;proc&#x2F;mounts</td>
<td>系统当前的所有挂载信息。</td>
</tr>
<tr>
<td>&#x2F;proc&#x2F;mtrr</td>
<td>系统使用的 Memory Type Range Registers（MTRRs）。</td>
</tr>
<tr>
<td>&#x2F;proc&#x2F;partitions</td>
<td>磁盘分区中的块分配信息。</td>
</tr>
<tr>
<td>&#x2F;proc&#x2F;slabinfo</td>
<td>系统中所有活动的 slab 缓存信息。</td>
</tr>
<tr>
<td>&#x2F;proc&#x2F;stat</td>
<td>所有的 CPU 活动信息。</td>
</tr>
<tr>
<td>&#x2F;proc&#x2F;sysrq-trigger</td>
<td>该文件是只写的。使用 echo 命令来写这个文件的时候，远程 root 用户可以执行大多数的系统请求关键命令，就好像在本地终端执行一样。要写入这个文件，需要把 &#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;sysrq 设置为1，开启 SysRq（Magic System Request Key）功能。</td>
</tr>
<tr>
<td>&#x2F;proc&#x2F;uptime</td>
<td>系统自开机以来的运行时间。</td>
</tr>
<tr>
<td>&#x2F;proc&#x2F;schedstat</td>
<td>kernel 调度器的统计信息。</td>
</tr>
<tr>
<td>&#x2F;proc&#x2F;swaps</td>
<td>交换区域的使用情况。</td>
</tr>
<tr>
<td><strong>&#x2F;proc&#x2F;version</strong></td>
<td>当前 Linux 内核版本、发行版号、gcc 版本号、更新时间等信息。</td>
</tr>
<tr>
<td>&#x2F;proc&#x2F;vmcore</td>
<td>内核 panic 时的内存映像。</td>
</tr>
<tr>
<td>&#x2F;proc&#x2F;vmstat</td>
<td>虚拟内存统计信息。</td>
</tr>
<tr>
<td>&#x2F;proc&#x2F;zoneinfo</td>
<td>显示内存空间的统计信息，对分析虚拟内存行为很有用。</td>
</tr>
</tbody></table>
<h2 id="硬盘阵列技术"><a href="#硬盘阵列技术" class="headerlink" title="硬盘阵列技术"></a>硬盘阵列技术</h2><p>RAID技术的设计初衷是减少因为采购硬盘设备带来的费用支出，但是与数据本身的价值相比较，<strong>现代企业更看重的则是RAID技术所具备的冗余备份机制以及带来的硬盘吞吐量的提升</strong>。也就是说，RAID不仅降低了硬盘设备损坏后丢失数据的几率，还提升了硬盘设备的读写速度，所以它在绝大多数运营商或大中型企业中得以广泛部署和应用。</p>
<h3 id="RAID-特性"><a href="#RAID-特性" class="headerlink" title="RAID 特性"></a>RAID 特性</h3><ul>
<li><strong>协同工作</strong>：多块硬盘通过一定的 RAID 级别协同工作。</li>
<li><strong>性能提升</strong>：通过并行读写提高数据吞吐量（如 RAID 0、RAID 10）。</li>
<li><strong>可靠性增强</strong>：通过数据冗余提高数据安全性（如 RAID 1、RAID 5）。</li>
<li><strong>容量组合</strong>：多块硬盘的容量可以组合成一个逻辑卷。</li>
<li><strong>应用场景</strong>：适用于服务器、企业级存储、大型数据库系统等。</li>
</ul>
<h3 id="常见的-RAID-级别"><a href="#常见的-RAID-级别" class="headerlink" title="常见的 RAID 级别"></a>常见的 RAID 级别</h3><table>
<thead>
<tr>
<th><strong>RAID 级别</strong></th>
<th><strong>特点</strong></th>
</tr>
</thead>
<tbody><tr>
<td>RAID 0</td>
<td>数据交错存放，性能提升，但无数据冗余，一块硬盘损坏即丢失全部数据</td>
</tr>
<tr>
<td>RAID 1</td>
<td>两块硬盘存储相同数据，可靠性高但容量利用率低，若使用软件RAID，可能写入性能会变差</td>
</tr>
<tr>
<td>RAID 5</td>
<td>分布式校验数据，性能和可靠性均衡，需要至少 3 块硬盘；当一块磁盘损毁时，可以通过同位检查码重建数据</td>
</tr>
<tr>
<td>RAID 10</td>
<td>RAID 1+0，性能和可靠性均高，需要至少 4 块硬盘</td>
</tr>
</tbody></table>
<h3 id="软件-RAID"><a href="#软件-RAID" class="headerlink" title="软件 RAID"></a><strong>软件 RAID</strong></h3><p>由于磁盘阵列有很多优秀的功能，然而硬件磁盘阵列卡偏偏又贵的很～因此就有发展出利用软件来仿真磁盘阵列的功能，这就是所谓的软件磁盘阵列（software RAID）。软件磁盘阵列主要是通过软件来仿真阵列的任务，因此会损耗较多的系统资源，比如说 CPU 的运算与I&#x2F;O 总线的资源等。</p>
<blockquote>
<p>硬件磁盘阵列（hardware RAID）是通过磁盘阵列卡来达成阵列的目的。磁盘阵列卡上面有一块专门的芯片在处理 RAID 的任务，因此在性能方面会比较好。</p>
</blockquote>
<p>软件实现 RAID，通过 Linux 的 <code>mdadm</code> 工具配置软件 RAID。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> mdadm --create /dev/md0 --level=5 --raid-devices=3 /dev/sd[b-d]</span><br></pre></td></tr></table></figure>

<h1 id="Linux-网络设备管理"><a href="#Linux-网络设备管理" class="headerlink" title="Linux 网络设备管理"></a>Linux 网络设备管理</h1><h2 id="网卡Bond"><a href="#网卡Bond" class="headerlink" title="网卡Bond"></a>网卡Bond</h2><p>所谓bond，就是把多个物理网卡绑定成一个逻辑上的网卡，使用同一个IP工作，有时服务器带宽不够了也可以用作增加带宽。</p>
<p>借助于网卡bond技术，不仅可以提高网络传输速度，更重要的是，还可以确保在其中一块网卡出现故障时，依然可以正常提供网络服务。</p>
<p>网卡绑定mode共有七种(0~6) bond0、bond1、bond2、bond3、bond4、bond5、bond6。常用的有三种：</p>
<ul>
<li>mode&#x3D;0（平衡负载模式）：平时两块网卡均工作，且自动备援，但需要在与服务器本地网卡相连的交换机设备上进行端口聚合来支持绑定技术。</li>
<li>mode&#x3D;1（自动备援模式）：平时只有一块主网卡工作，在它故障后自动替换为另外的网卡。</li>
<li>mode&#x3D;6（平衡负载模式）：平时两块网卡均工作，且自动备援，无须交换机设备提供辅助支持。</li>
</ul>
<h3 id="1-Bond准备工作"><a href="#1-Bond准备工作" class="headerlink" title="1.Bond准备工作"></a>1.Bond准备工作</h3><p>首先要确定服务器上的网卡规划用途，以及哪些网卡已插网线，一般是有两块网卡对应两根网线，分别连接不同的交换机。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@master01 network-scripts]# ethtool p4p2</span><br><span class="line">Settings <span class="keyword">for</span> p4p2:</span><br><span class="line">        Supported ports: [ FIBRE ]</span><br><span class="line">        Supported <span class="built_in">link</span> modes:   1000baseKX/Full</span><br><span class="line">                                10000baseKR/Full</span><br><span class="line">                                25000baseCR/Full</span><br><span class="line">                                25000baseKR/Full</span><br><span class="line">                                25000baseSR/Full</span><br><span class="line">        Supported pause frame use: Symmetric</span><br><span class="line">        Supports auto-negotiation: Yes</span><br><span class="line">        Supported FEC modes: None BaseR</span><br><span class="line">        Advertised <span class="built_in">link</span> modes:  1000baseKX/Full</span><br><span class="line">                                10000baseKR/Full</span><br><span class="line">                                25000baseCR/Full</span><br><span class="line">                                25000baseKR/Full</span><br><span class="line">                                25000baseSR/Full</span><br><span class="line">        Advertised pause frame use: Symmetric</span><br><span class="line">        Advertised auto-negotiation: Yes</span><br><span class="line">        Advertised FEC modes: None</span><br><span class="line">        Speed: 10000Mb/s</span><br><span class="line">        Duplex: Full</span><br><span class="line">        Port: FIBRE</span><br><span class="line">        PHYAD: 0</span><br><span class="line">        Transceiver: internal</span><br><span class="line">        Auto-negotiation: on</span><br><span class="line">        Supports Wake-on: d</span><br><span class="line">        Wake-on: d</span><br><span class="line">        Current message level: 0x00000004 (4)</span><br><span class="line">                               <span class="built_in">link</span></span><br><span class="line">        Link detected: <span class="built_in">yes</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ethtool查看网卡信息，<code>Link detected：yes</code>表示有网线插入；</p>
<p>如果<code>Link detected:no</code> 的话，尝试用<code>ifup ethxxx</code>，如果依然为no的话，才能说明此网卡确实没有网线插入。</p>
</blockquote>
<h3 id="2-网卡Bond配置"><a href="#2-网卡Bond配置" class="headerlink" title="2.网卡Bond配置"></a>2.网卡Bond配置</h3><p>方法一：命令行配置</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个名为 storagepub 的网卡绑定接口，类型为 bond，模式为 802.3ad</span></span><br><span class="line">ip <span class="built_in">link</span> add storagepub <span class="built_in">type</span> bond mode 802.3ad xmit_hash_policy layer3+4</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭网卡</span></span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> ens4np1 down</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将网卡 ens4np1 加入到名为 storagepub 的绑定接口，成为其从属（slave）设备</span></span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> ens4np1 master storagepub</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用网卡</span></span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> ens4np1 up</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用绑定接口 storagepub，使其可用</span></span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> storagepub up</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看绑定接口 storagepub 的详细信息，包括模式、成员网卡、负载均衡策略等。</span></span><br><span class="line"><span class="built_in">cat</span> /proc/net/bonding/storagepub</span><br></pre></td></tr></table></figure>

<p>方法二：修改bond网卡的配置文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@master01 network-scripts]# <span class="built_in">cat</span> ifcfg-bond-storagepub</span><br><span class="line">DEVICE=storagepub</span><br><span class="line">BONDING_OPTS=<span class="string">&quot;mode=4 miimon=100 xmit_hash_policy=1&quot;</span></span><br><span class="line">TYPE=Bond</span><br><span class="line">BONDING_MASTER=<span class="built_in">yes</span>	<span class="comment"># 表示该设备是绑定主设备（master）。</span></span><br><span class="line">BOOTPROTO=static	<span class="comment"># 使用静态 IP 配置（不依赖 DHCP）</span></span><br><span class="line">PEERDNS=no</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=no	<span class="comment"># 不启用 IPv6 配置</span></span><br><span class="line">NAME=bond-storagepub</span><br><span class="line">ONBOOT=<span class="built_in">yes</span></span><br><span class="line">IPADDR=172.22.88.177</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line"></span><br><span class="line">[root@master01 network-scripts]# <span class="built_in">cat</span> ifcfg-p4p2</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">DEVICE=p4p2</span><br><span class="line">ONBOOT=<span class="built_in">yes</span></span><br><span class="line">MASTER=storagepub	<span class="comment"># 指定绑定接口的主设备为 storagepu。</span></span><br><span class="line">SLAVE=<span class="built_in">yes</span>	<span class="comment"># 指定该网卡是绑定接口的从设备（slave）</span></span><br></pre></td></tr></table></figure>

<h3 id="3-重启网络验证"><a href="#3-重启网络验证" class="headerlink" title="3.重启网络验证"></a>3.重启网络验证</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@master01 ~]# systemctl restart network</span><br><span class="line"></span><br><span class="line">[root@master01 ~]# ip a |grep storagepub</span><br><span class="line">11: p4p2: &lt;BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP&gt; mtu 1500 qdisc mq master storagepub state UP group default qlen 1000</span><br><span class="line">19: storagepub: &lt;BROADCAST,MULTICAST,MASTER,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    inet 172.22.88.177/24 brd 172.22.88.255 scope global noprefixroute storagepub</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/05/26/nfs_server_install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liaoxb">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liaoxb's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | liaoxb's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/05/26/nfs_server_install/" class="post-title-link" itemprop="url">NFS服务器搭建和挂载</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-05-26 00:00:00" itemprop="dateCreated datePublished" datetime="2018-05-26T00:00:00+08:00">2018-05-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E4%BD%9C%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">工作笔记</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="nfs-server-install"><a href="#nfs-server-install" class="headerlink" title="nfs-server-install"></a>nfs-server-install</h1><p>NFS 是Network File System的缩写，即网络文件系统。功能是通过网络让不同的机器、不同的操作系统能够彼此分享个别的数据，让应用程序在客户端通过网络访问位于服务器磁盘中的数据，是在类Unix系统间实现磁盘文件共享的一种方法。<br>NFS在文件传送或信息传送过程中依赖于RPC协议。所以只要用到NFS的地方都要启动RPC服务，不论是NFS SERVER或者NFS CLIENT。这样SERVER和CLIENT才能通过RPC来实现PROGRAM PORT（centos5之前，之后是rpcbind）的对应。可以这么理解RPC和NFS的关系：NFS是一个文件系统，而RPC是负责信息的传输。</p>
<p>Centos系统环境：<br>服务端IP 192.168.1.28<br>客户端IP 192.168.1.21、192.168.1.155</p>
<p>一、安装NFS-Server</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa|grep nfs <span class="comment">#检查系统是否已安装NFS</span></span><br><span class="line">yum install nfs-utils -y <span class="comment">#客户端和服务端都要安装</span></span><br></pre></td></tr></table></figure>



<p><img src="https://github.com/liaoxiaobo/liaoxiaobo.github.io/blob/blog/source/image/nfs/nfs01.png?raw=true" alt="image"></p>
<p>二、服务端配置启动NFS</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mkdir /var/nfsshare </span><br><span class="line">vim /etc/exports #配置共享目录供客户端集群以读写权限访问</span><br><span class="line">systemctl start nfs</span><br><span class="line">showmount -e localhost //查询NFS的共享状态</span><br><span class="line"></span><br><span class="line">[root@test--0004 ~]# showmount -e 192.168.1.28</span><br><span class="line">Export list for 192.168.1.28:</span><br><span class="line">/var/nfsshare2 *</span><br><span class="line">/var/nfsshare *</span><br></pre></td></tr></table></figure>



<p>说明：NFS服务的配置文件为&#x2F;etc&#x2F;exports，这个文件是NFS的主要配置文件，不过系统并没有默认值，所以这个文件不一定会存在，可能要使用vim手动建立，然后在文件里面写入配置内容。内容格式如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;输出目录&gt; [客户端1 选项（访问权限,用户映射,其他）] [客户端2 选项（访问权限,用户映射,其他)]</span><br></pre></td></tr></table></figure>



<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">1、输出目录：输出目录是指NFS系统中需要共享给客户机使用的目录；</span><br><span class="line">2、客户端：客户端是指网络中可以访问这个NFS输出目录的计算机</span><br><span class="line">          客户端常用的指定方式：</span><br><span class="line">          指定ip地址的主机：192.168.8.106</span><br><span class="line">          指定子网中的所有主机：192.168.0.0/24或 192.168.0.0/255.255.255.0</span><br><span class="line">          指定域名的主机：wj.bsmart.com</span><br><span class="line">          指定域中的所有主机：*.bsmart.com</span><br><span class="line">          所有主机：*</span><br><span class="line"></span><br><span class="line">3、 选项：选项用来设置输出目录的访问权限、用户映射等。</span><br><span class="line"></span><br><span class="line">   NFS主要有3类选项：</span><br><span class="line"></span><br><span class="line">  1）访问权限选项：</span><br><span class="line"></span><br><span class="line">          设置输出目录只读：ro</span><br><span class="line">          设置输出目录读写：rw</span><br><span class="line">          </span><br><span class="line">2）用户映射选项</span><br><span class="line"></span><br><span class="line">    all_squash：将远程访问的所有普通用户及所属组都映射为匿名用户或用户组（nfsnobody）；</span><br><span class="line">    no_all_squash：与all_squash取反（默认设置）；</span><br><span class="line">    root_squash：将root用户及所属组都映射为匿名用户或用户组（默认设置）；</span><br><span class="line">    no_root_squash：与rootsquash取反；</span><br><span class="line">    anonuid=xxx：将远程访问的所有用户都映射为匿名用户，并指定该用户为本地用户（UID=xxx）；</span><br><span class="line">    anongid=xxx：将远程访问的所有用户组都映射为匿名用户组账户，并指定该匿名用户组账户为本地用户组账户（GID=xxx）；</span><br><span class="line"></span><br><span class="line">3）其它选项</span><br><span class="line"></span><br><span class="line">    secure：限制客户端只能从小于1024的tcp/ip端口连接nfs服务器（默认设置）；</span><br><span class="line">    insecure：允许客户端从大于1024的tcp/ip端口连接服务器；</span><br><span class="line">    <span class="built_in">sync</span>：将数据同步写入内存缓冲区与磁盘中，效率低，但可以保证数据的一致性；</span><br><span class="line">    async：将数据先保存在内存缓冲区中，必要时才写入磁盘；</span><br><span class="line">    wdelay：检查是否有相关的写操作，如果有则将这些写操作一起执行，这样可以提高效率（默认设置）；</span><br><span class="line">    no_wdelay：若有写操作则立即执行，应与<span class="built_in">sync</span>配合使用；</span><br><span class="line">    subtree：若输出目录是一个子目录，则nfs服务器将检查其父目录的权限(默认设置)；</span><br><span class="line">    no_subtree：即使输出目录是一个子目录，nfs服务器也不检查其父目录的权限，这样可以提高效率；</span><br></pre></td></tr></table></figure>

<p>三、设置开机启动</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> rpcbind.service</span><br><span class="line">systemctl <span class="built_in">enable</span> nfs-service</span><br></pre></td></tr></table></figure>



<p>四、测试挂载：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">客户端执行：</span><br><span class="line">mount -t nfs 192.168.1.28:/var/nfsshare /mnt <span class="comment">#客户端挂载NFS服务器中的共享目录</span></span><br><span class="line"><span class="built_in">touch</span> /mnt/test.txt <span class="comment">#客户端挂载点生成文件，此文件会被共享至NFS服务器:/var/nfsshare</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;hello word&quot;</span> &gt; /mnt/test.txt</span><br><span class="line">umount /mnt <span class="comment">#解除和NFS服务器的挂载</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2017/07/05/linux_cmd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="liaoxb">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liaoxb's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | liaoxb's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/07/05/linux_cmd/" class="post-title-link" itemprop="url">Linux 常用命令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-07-05 20:36:25" itemprop="dateCreated datePublished" datetime="2017-07-05T20:36:25+08:00">2017-07-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>10k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>9 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="文件目录管理"><a href="#文件目录管理" class="headerlink" title="文件目录管理"></a>文件目录管理</h1><h2 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h2><p>grep命令用于在文本中执行关键词搜索，并显示匹配的结果，格式为“grep [选项] [文件]”。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>-b</td>
<td>将可执行文件(binary)当作文本文件（text）来搜索</td>
</tr>
<tr>
<td>-c</td>
<td>仅显示找到的行数</td>
</tr>
<tr>
<td>-i</td>
<td>忽略大小写</td>
</tr>
<tr>
<td>-n</td>
<td>显示行号</td>
</tr>
<tr>
<td>-v</td>
<td>反向选择——仅列出没有“关键词”的行。</td>
</tr>
<tr>
<td>-A</td>
<td>除了显示符合范本样式的那一行之外，并显示该行之后的内容。</td>
</tr>
<tr>
<td>-B</td>
<td>在显示符合范本样式的那一行之外，并显示该行之前的内容。</td>
</tr>
<tr>
<td>-C</td>
<td>除了显示符合范本样式的那一列之外，并显示该列之前后的内容。</td>
</tr>
</tbody></table>
<h2 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">localhost% <span class="built_in">cat</span> test.txt</span><br><span class="line">NAME    STATUS   ROLES                    AGE   VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE                KERNEL-VERSION          CONTAINER-RUNTIME</span><br><span class="line">k8s01   Ready    wise-controller          38d   v1.16.4   192.168.0.3    &lt;none&gt;        CentOS                  3.10.0-862.el7.x86_64   docker://18.9.8</span><br><span class="line">k8s02   Ready    wise-controller          38d   v1.16.4   192.168.0.7    &lt;none&gt;        CentOS                  3.10.0-862.el7.x86_64   docker://18.9.8</span><br><span class="line">k8s03   Ready    wise-controller          38d   v1.16.4   192.168.0.10   &lt;none&gt;        CentOS                  3.10.0-862.el7.x86_64   docker://18.9.8</span><br><span class="line">k8s04   NotReady node                     38d   v1.16.4   192.168.0.15   &lt;none&gt;        CentOS                  3.10.0-862.el7.x86_64   docker://18.9.8</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印文件的第一列和第五列</span></span><br><span class="line">localhost% awk <span class="string">&#x27;&#123;print $1,$5&#125;&#x27;</span> test.txt</span><br><span class="line">NAME VERSION</span><br><span class="line">k8s01 v1.16.4</span><br><span class="line">k8s02 v1.16.4</span><br><span class="line">k8s03 v1.16.4</span><br><span class="line">k8s04 v1.16.4</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印最后一列字段</span></span><br><span class="line">localhost% awk <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span> test.txt</span><br><span class="line">CONTAINER-RUNTIME</span><br><span class="line">docker://18.9.8</span><br><span class="line">docker://18.9.8</span><br><span class="line">docker://18.9.8</span><br><span class="line">docker://18.9.8</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印倒数第二列字段：</span></span><br><span class="line">localhost% awk <span class="string">&#x27;&#123;print $(NF-1)&#125;&#x27;</span> test.txt</span><br><span class="line">KERNEL-VERSION</span><br><span class="line">3.10.0-862.el7.x86_64</span><br><span class="line">3.10.0-862.el7.x86_64</span><br><span class="line">3.10.0-862.el7.x86_64</span><br><span class="line">3.10.0-862.el7.x86_64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印文本文件的总行数</span></span><br><span class="line">localhost% awk <span class="string">&#x27;END&#123;print NR&#125;&#x27;</span> test.txt</span><br><span class="line">5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印文本第1行数据</span></span><br><span class="line">localhost% awk <span class="string">&#x27;NR==1&#123;print&#125;&#x27;</span> test.txt</span><br><span class="line">NAME    STATUS   ROLES                    AGE   VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE                KERNEL-VERSION          CONTAINER-RUNTIME</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印文本大于第1行的数据</span></span><br><span class="line">localhost% awk <span class="string">&#x27;NR&gt;1&#123;print&#125;&#x27;</span> test.txt</span><br><span class="line">k8s01   Ready    wise-controller          38d   v1.16.4   192.168.0.3    &lt;none&gt;        CentOS                  3.10.0-862.el7.x86_64   docker://18.9.8</span><br><span class="line">k8s02   Ready    wise-controller          38d   v1.16.4   192.168.0.7    &lt;none&gt;        CentOS                  3.10.0-862.el7.x86_64   docker://18.9.8</span><br><span class="line">k8s03   Ready    wise-controller          38d   v1.16.4   192.168.0.10   &lt;none&gt;        CentOS                  3.10.0-862.el7.x86_64   docker://18.9.8</span><br><span class="line">k8s04   NotReady node                     38d   v1.16.4   192.168.0.15   &lt;none&gt;        CentOS                  3.10.0-862.el7.x86_64   docker://18.9.8</span><br></pre></td></tr></table></figure>

<h2 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h2><p>定位到数据行并对数据进行增删改查操作</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 替换文本中的字符串：</span></span><br><span class="line">sed <span class="string">&#x27;s/book/books/&#x27;</span> file</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用后缀/g标记会替换每一行中的所有匹配：</span></span><br><span class="line">[root@harbor image_pull_push]# <span class="built_in">cat</span> img-list.txt |sed <span class="string">&#x27;s/registry.cn-hangzhou.aliyuncs.com/192.168.0.11/g&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 当需要从第N处匹配配开始替换时，可以使用 /Ng：</span></span><br><span class="line"><span class="built_in">echo</span> sksksksksksk | sed <span class="string">&#x27;s/sk/SK/3g&#x27;</span></span><br><span class="line">skskSKSKSKSK</span><br><span class="line"></span><br><span class="line"><span class="comment"># 替换某目录下所有文件的某字符串</span></span><br><span class="line">oldip=172.22.12.241</span><br><span class="line">newip=172.22.12.242</span><br><span class="line"><span class="comment"># 查看之前包含oldip的文件</span></span><br><span class="line">find . -<span class="built_in">type</span> f | xargs grep <span class="variable">$oldip</span></span><br><span class="line"><span class="comment"># 替换IP地址</span></span><br><span class="line">find . -<span class="built_in">type</span> f | xargs sed -i <span class="string">&quot;s/<span class="variable">$oldip</span>/<span class="variable">$newip</span>/&quot;</span></span><br><span class="line"><span class="comment"># 检查更新后的</span></span><br><span class="line">find . -<span class="built_in">type</span> f | xargs grep <span class="variable">$newip</span></span><br></pre></td></tr></table></figure>

<h2 id="find"><a href="#find" class="headerlink" title="find"></a>find</h2><p>find命令用于按照指定条件来查找文件，格式为“find [查找路径] 寻找条件 操作”。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>-name</td>
<td>匹配名称</td>
</tr>
<tr>
<td>-perm</td>
<td>匹配权限（mode为完全匹配，-mode为包含即可）</td>
</tr>
<tr>
<td>-user</td>
<td>匹配所有者</td>
</tr>
<tr>
<td>-group</td>
<td>匹配所有组</td>
</tr>
<tr>
<td>-mtime -n +n</td>
<td>匹配修改内容的时间（-n指n天以内，+n指n天以前）</td>
</tr>
<tr>
<td>-atime -n +n</td>
<td>匹配访问文件的时间（-n指n天以内，+n指n天以前）</td>
</tr>
<tr>
<td>-ctime -n +n</td>
<td>匹配修改文件权限的时间（-n指n天以内，+n指n天以前）</td>
</tr>
<tr>
<td>-nouser</td>
<td>匹配无所有者的文件</td>
</tr>
<tr>
<td>-nogroup</td>
<td>匹配无所有组的文件</td>
</tr>
<tr>
<td>-newer f1 !f2</td>
<td>匹配比文件f1新但比f2旧的文件</td>
</tr>
<tr>
<td>-type b&#x2F;d&#x2F;c&#x2F;p&#x2F;l&#x2F;f</td>
<td>匹配文件类型（后面的字幕字母依次表示块设备、目录、字符设备、管道、链接文件、文本文件）</td>
</tr>
<tr>
<td>-size</td>
<td>匹配文件的大小（+50KB为查找超过50KB的文件，而-50KB为查找小于50KB的文件）</td>
</tr>
<tr>
<td>-prune</td>
<td>忽略某个目录</td>
</tr>
<tr>
<td>-exec …… {};</td>
<td>后面可跟用于进一步处理搜索结果的命令（下文会有演示）</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查找当前目录下是否存在README.md </span></span><br><span class="line">find . -name README.md</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找etc目录是否存在以host开头的文件</span></span><br><span class="line">find /etc -name host* </span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定目录查找大于1G的文件</span></span><br><span class="line">find / -size +1024M</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当前目录搜索所有文件，文件内容 包含 “140.206.111.111” 的内容</span></span><br><span class="line">find . -<span class="built_in">type</span> f -name <span class="string">&quot;*&quot;</span> | xargs grep <span class="string">&quot;140.206.111.111&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="echo"><a href="#echo" class="headerlink" title="echo"></a>echo</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建带有内容的文件</span></span><br><span class="line">[root@harbor ~]# <span class="built_in">echo</span> hello &gt; new.yaml</span><br><span class="line">[root@harbor ~]# <span class="built_in">cat</span> new.yaml</span><br><span class="line">hello</span><br><span class="line"><span class="comment"># 追加写入文件</span></span><br><span class="line">[root@harbor ~]# <span class="built_in">echo</span> hello-test &gt;&gt; new.yaml</span><br><span class="line">[root@harbor ~]# <span class="built_in">cat</span> new.yaml</span><br><span class="line">hello</span><br><span class="line">hello-test</span><br></pre></td></tr></table></figure>

<h2 id="dd"><a href="#dd" class="headerlink" title="dd"></a>dd</h2><p>dd命令用于按照指定大小和个数的数据块来复制文件或转换文件，格式为“dd [参数]”。</p>
<p>Linux系统中有一个名为&#x2F;dev&#x2F;zero的设备文件，这个文件不会占用系统存储空间，但却可以提供无穷无尽的数据，因此可以使用它作为dd命令的输入文件，来生成一个指定大小的文件。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>if</td>
<td>输入的文件名称，如果不指定if，默认就会从stdin中读取输入。</td>
</tr>
<tr>
<td>of</td>
<td>输出的文件名称，如果不指定of，默认就会将stdout作为默认输出。</td>
</tr>
<tr>
<td>bs</td>
<td>设置每个“块”的大小</td>
</tr>
<tr>
<td>count</td>
<td>设置要复制“块”的个数</td>
</tr>
</tbody></table>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从/dev/zero设备文件中取出一个大小为100M的数据块</span></span><br><span class="line">[root@master01 ~]# <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=sun.txt bs=100M count=1</span><br><span class="line">1+0 records <span class="keyword">in</span></span><br><span class="line">1+0 records out</span><br><span class="line">104857600 bytes (105 MB, 100 MiB) copied, 0.0580656 s, 1.8 GB/s</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试磁盘写入速度</span></span><br><span class="line">[root@localhost ~]# dd if=/dev/zero of=/tmp/testfile bs=1G count=1 oflag=direct</span><br><span class="line">1+0 records in</span><br><span class="line">1+0 records out</span><br><span class="line">1073741824 bytes (1.1 GB) copied, 7.10845 s, 151 MB/s</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试磁盘读取速度</span></span><br><span class="line">[root@localhost ~]# dd if=/tmp/testfile of=/dev/null bs=1G count=1 iflag=direct</span><br><span class="line">1+0 records in</span><br><span class="line">1+0 records out</span><br><span class="line">1073741824 bytes (1.1 GB) copied, 6.53009 s, 164 MB/s</span><br></pre></td></tr></table></figure>

<h2 id="tar"><a href="#tar" class="headerlink" title="tar"></a>tar</h2><p>tar命令用于对文件进行打包压缩或解压，格式为“tar [选项] [文件]”。在Linux系统中，常见的文件格式比较多，其中主要使用的是.tar或.tar.gz或.tar.bz2格式。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>-c</td>
<td>创建压缩文件</td>
</tr>
<tr>
<td>-x</td>
<td>解开压缩文件</td>
</tr>
<tr>
<td>-t</td>
<td>查看压缩包内有哪些文件</td>
</tr>
<tr>
<td>-z</td>
<td>用Gzip压缩或解压</td>
</tr>
<tr>
<td>-j</td>
<td>用bzip2压缩或解压</td>
</tr>
<tr>
<td>-v</td>
<td>显示压缩或解压的过程</td>
</tr>
<tr>
<td>-f</td>
<td>目标文件名</td>
</tr>
<tr>
<td>-p</td>
<td>保留原始的权限与属性</td>
</tr>
<tr>
<td>-P</td>
<td>使用绝对路径来压缩</td>
</tr>
<tr>
<td>-C</td>
<td>指定解压到的目录</td>
</tr>
</tbody></table>
<p>命令示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 仅打包，不压缩！将 /home/vivek/bin/ 目录打包</span></span><br><span class="line">tar -cvf /tmp/bin-backup.tar /home/vivek/bin/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打包 并使用 bzip2 算法压缩压缩</span></span><br><span class="line">tar -jcvf /tmp/bin-backup.tar.bz2 /home/vivek/bin/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打包 并使用 gzip 算法压缩压缩</span></span><br><span class="line">tar -zcvf /tmp/bin-backup.tar.gz /home/vivek/bin/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压缩</span></span><br><span class="line">tar -zxvf bin-backup.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 详细列举包里的所有文件</span></span><br><span class="line">tar -tvf /opt/extra.tgz</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">上下翻页：Ctrl+f、Ctrl+b</span><br><span class="line">跳到当前行最后字符处：Fn+右键</span><br><span class="line">跳到当前行最前面字符处：Fn+左键、0</span><br><span class="line"></span><br><span class="line">查找字符串：/字符串  n继续查找</span><br><span class="line">字符全局替换：:%s/foo/bar/g  :&#123;作用范围&#125;s/&#123;目标&#125;/&#123;替换&#125;/&#123;替换标志&#125;</span><br><span class="line"></span><br><span class="line">x或X：删除一个字符，x删除光标后的，而X删除光标前的；</span><br><span class="line">D：删除从当前光标到光标所在行尾的全部字符；</span><br><span class="line">删除行：<span class="built_in">dd</span> ndd（n代表删除或复制的行数）</span><br><span class="line">复制行：yy  nyy</span><br><span class="line">粘贴行：p、P</span><br><span class="line"></span><br><span class="line">复原前一个操作：u</span><br><span class="line">重做上一个操作：ctrl+r</span><br><span class="line">显示行号：:<span class="built_in">set</span> nu</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Ctrl+u：向文件首翻半屏；</span><br><span class="line">Ctrl+d：向文件尾翻半屏；</span><br><span class="line">Ctrl+f：向文件尾翻一屏；</span><br><span class="line">Ctrl+b：向文件首翻一屏；</span><br><span class="line">Esc：从编辑模式切换到命令模式；</span><br><span class="line">ZZ：命令模式下保存当前文件所做的修改后退出vi；</span><br><span class="line">:行号：光标跳转到指定行的行首；</span><br><span class="line">:$：光标跳转到最后一行的行首；</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="scp"><a href="#scp" class="headerlink" title="scp"></a>scp</h2><p><strong>scp命令</strong> 用于在Linux下进行远程拷贝文件的命令，和它类似的命令有cp，不过cp只是在本机进行拷贝不能跨服务器，而且scp传输是加密的。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从远程拷贝目录到本地</span></span><br><span class="line">scp -r root@10.10.10.10:/opt/soft/mongodb /opt/soft/ </span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传本地目录到远程机器指定目录</span></span><br><span class="line">scp -r /opt/soft/mongodb root@10.10.10.10:/opt/soft/scptest</span><br></pre></td></tr></table></figure>

<h2 id="vi"><a href="#vi" class="headerlink" title="vi"></a>vi</h2><p>vi编辑器提供了丰富的内置命令，有些内置命令使用键盘组合键即可完成，有些内置命令则需要以冒号“：”开头输入。</p>
<p>常用内置命令如下：</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>dd</td>
<td>删除（剪切）光标所在整行</td>
</tr>
<tr>
<td>5dd</td>
<td>删除（剪切）从光标处开始的5行</td>
</tr>
<tr>
<td>yy</td>
<td>复制光标所在整行</td>
</tr>
<tr>
<td>5yy</td>
<td>复制从光标处开始的5行</td>
</tr>
<tr>
<td>u</td>
<td>撤销上一步的操作</td>
</tr>
<tr>
<td>p</td>
<td>将之前删除（dd）或复制（yy）过的数据粘贴到光标后面</td>
</tr>
<tr>
<td>D</td>
<td>删除光标处所在行尾的全部字符</td>
</tr>
<tr>
<td>x</td>
<td>删除光标处的一个字符</td>
</tr>
<tr>
<td>:set nu</td>
<td>显示行号</td>
</tr>
<tr>
<td>&#x2F;string、?string</td>
<td>查找字符串，常结合n&#x2F;N可以继续查找上一个、下一个字符串</td>
</tr>
<tr>
<td>:s&#x2F;foo&#x2F;bar&#x2F;g</td>
<td>将当前光标所在行的所有foo替换成bar</td>
</tr>
<tr>
<td>:%s&#x2F;foo&#x2F;bar&#x2F;g</td>
<td>将全文中的所有foo替换成bar</td>
</tr>
<tr>
<td>Fn+右键</td>
<td>光标跳到当前行最后一个字符</td>
</tr>
<tr>
<td>Fn+右键、0</td>
<td>光标跳到当前行第一个字符</td>
</tr>
<tr>
<td>Ctrl+f、Ctrl+b</td>
<td>上下翻页</td>
</tr>
</tbody></table>
<h2 id="file"><a href="#file" class="headerlink" title="file"></a>file</h2><p>file命令用于查看文件的类型，格式为“file 文件名”。</p>
<p>在Linux系统中，由于文本、目录、设备等所有这些一切都统称为文件，而我们又不能单凭后缀就知道具体的文件类型，这时就需要使用file命令来查看文件类型了。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master01 ~]# file admin-openrc.sh</span><br><span class="line">admin-openrc.sh: ASCII text</span><br><span class="line"></span><br><span class="line">[root@master01 ~]# file /dev/sda</span><br><span class="line">/dev/sda: block special (8/0)</span><br></pre></td></tr></table></figure>

<h2 id="wc"><a href="#wc" class="headerlink" title="wc"></a>wc</h2><p><code>wc</code> 命令用于统计指定文本的行数、字数、字节数，格式为“<code>wc [参数]</code> 文本”。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>-l</code></td>
<td>只显示行数</td>
</tr>
<tr>
<td><code>-w</code></td>
<td>只显示单词数</td>
</tr>
<tr>
<td><code>-c</code></td>
<td>只显示字节数</td>
</tr>
</tbody></table>
<h1 id="网络管理"><a href="#网络管理" class="headerlink" title="网络管理"></a>网络管理</h1><h2 id="ip"><a href="#ip" class="headerlink" title="ip"></a>ip</h2><p><strong>ip命令</strong> 用来显示或操纵Linux主机的路由、网络设备、策略路由和隧道，是Linux下较新的功能强大的网络配置工具。</p>
<p>网卡配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ip <span class="built_in">link</span>                          <span class="comment"># 显示网络接口信息</span></span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> eth0 up              <span class="comment"># 开启网卡</span></span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> eth0 down            <span class="comment"># 关闭网卡</span></span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> eth0 promisc on      <span class="comment"># 开启网卡的混合模式</span></span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> eth0 promisc offi    <span class="comment"># 关闭网卡的混合模式</span></span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> eth0 txqueuelen 1200 <span class="comment"># 设置网卡队列长度</span></span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> eth0 mtu 1400        <span class="comment"># 设置网卡最大传输单元</span></span><br><span class="line"></span><br><span class="line">ip a                             <span class="comment"># 显示网卡IP信息</span></span><br><span class="line">ip a a 192.168.0.1/24 dev eth0 <span class="comment"># 为eth0网卡添加IP地址192.168.0.1</span></span><br><span class="line">ip a d 192.168.0.1/24 dev eth0 <span class="comment"># 为eth0网卡删除一个IP地址192.168.0.1</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ip命令配置网卡信息，在网卡或机器重启后配置会丢失。要想配置永久生效，那就要修改网卡配置文件。如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 文件名对应网口名，CentOS 7\8 默认配置文件</span></span><br><span class="line">[Linux]# vi /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line">DEVICE=<span class="string">&quot;eth0&quot;</span></span><br><span class="line">BOOTPROTO=<span class="string">&quot;static&quot;</span></span><br><span class="line">BROADCAST=<span class="string">&quot;192.168.0.255&quot;</span></span><br><span class="line">HWADDR=<span class="string">&quot;00:16:36:1B:BB:74&quot;</span></span><br><span class="line">IPADDR=<span class="string">&quot;192.168.0.100&quot;</span></span><br><span class="line">NETMASK=<span class="string">&quot;255.255.255.0&quot;</span></span><br><span class="line">ONBOOT=<span class="string">&quot;yes&quot;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>路由配置</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ip r                         <span class="comment"># 显示系统路由</span></span><br><span class="line">ip r add default via 192.168.1.254   <span class="comment"># 设置系统默认路由</span></span><br><span class="line">ip r d default          <span class="comment"># 删除默认路由</span></span><br><span class="line"></span><br><span class="line">ip r a 192.168.4.0/24 via 192.168.0.254 dev eth0 <span class="comment"># 设置192.168.4.0网段的网关为192.168.0.254,数据走eth0接口</span></span><br><span class="line">ip r a default via 192.168.0.254 dev eth0        <span class="comment"># 设置默认网关为192.168.0.254</span></span><br><span class="line">ip r d 192.168.4.0/24   <span class="comment"># 删除192.168.4.0网段的网关</span></span><br><span class="line">ip r d 192.168.1.0/24 dev eth0 <span class="comment"># 删除路由</span></span><br></pre></td></tr></table></figure>

<h2 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h2><p>有时进程之间需要通信，需要开启一个socket，socket就是对外建立连接的一个窗口，然后借助TCP协议进行通信。但进行通信之前首先需要进程开启一个端口，这时就可以通过netstat命令查看开启的端口以及由哪个进程开启</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#列出所有端口</span></span><br><span class="line">netstat -a</span><br><span class="line"><span class="comment">#列出所有tcp端口</span></span><br><span class="line">netstat -at</span><br><span class="line"><span class="comment">#列出所有udp端口</span></span><br><span class="line">netstat -au</span><br><span class="line"><span class="comment">#只列出所有监听 udp 端口</span></span><br><span class="line">netstat -lu</span><br><span class="line"><span class="comment"># 通过端口找进程ID</span></span><br><span class="line">netstat -anp|grep 8081 | grep LISTEN|awk <span class="string">&#x27;&#123;printf $7&#125;&#x27;</span>|<span class="built_in">cut</span> -d/ -f1</span><br><span class="line"></span><br><span class="line">-n或--numeric：直接使用ip地址，而不通过域名服务器；</span><br><span class="line">-l或--listening：显示监控中的服务器的Socket</span><br><span class="line">-p或--programs：添加“PID/进程名称”到netstat输出中；</span><br></pre></td></tr></table></figure>

<h2 id="ss"><a href="#ss" class="headerlink" title="ss"></a>ss</h2><p>ss 可以用来获取socket统计信息，它可以显示和netstat类似的内容。但ss的优势在于它能够显示更多更详细的有关TCP和连接状态的信息，而且比netstat更快速更高效。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ss -t -a    <span class="comment"># 显示TCP连接</span></span><br><span class="line">ss -u -a    <span class="comment"># 显示所有UDP Sockets</span></span><br><span class="line">ss -s       <span class="comment"># 显示 Sockets 摘要</span></span><br><span class="line">ss -l       <span class="comment"># 列出所有打开的网络连接端口</span></span><br><span class="line">ss -pl      <span class="comment"># 查看进程使用的socket</span></span><br><span class="line">ss -lp | grep 3306  <span class="comment"># 找出打开套接字/端口应用程序</span></span><br></pre></td></tr></table></figure>

<h1 id="系统管理"><a href="#系统管理" class="headerlink" title="系统管理"></a>系统管理</h1><h2 id="firewalld-cmd"><a href="#firewalld-cmd" class="headerlink" title="firewalld-cmd"></a>firewalld-cmd</h2><p>firewalld是centos7的一大特性，最大的好处有两个：支持动态更新，不用重启服务；第二个就是加入了防火墙的“zone”概念。</p>
<p>firewalld自身并不具备防火墙的功能，而是和iptables一样需要通过内核的netfilter来实现，也就是说firewalld和 iptables一样，他们的作用都是用于维护规则，而真正使用规则干活的是内核的netfilter，只不过firewalld和iptables的结 构以及使用方法不一样罢了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@master01 ~]# firewall-cmd --zone=public --list-ports</span><br><span class="line">2121/tcp 3306/tcp 8081/tcp 30000/tcp 38060/tcp 40000/tcp 40001/tcp</span><br><span class="line"></span><br><span class="line">[root@master01 ~]# firewall-cmd --permanent --add-port=3307/tcp --zone=public</span><br><span class="line">success</span><br><span class="line"></span><br><span class="line">[root@master01 ~]# firewall-cmd --reload</span><br><span class="line">success</span><br><span class="line"></span><br><span class="line">[root@master01 ~]# firewall-cmd --zone=public --list-ports</span><br><span class="line">2121/tcp 3306/tcp 3307/tcp 8081/tcp 30000/tcp 38060/tcp 40000/tcp 40001/tcp</span><br></pre></td></tr></table></figure>

<p>firewalld中常见的zone（默认为public）以及相应的策略规则如下所示：</p>
<table>
<thead>
<tr>
<th>区域</th>
<th align="left">默认规则策略</th>
</tr>
</thead>
<tbody><tr>
<td>trusted</td>
<td align="left">允许所有的数据包</td>
</tr>
<tr>
<td>home</td>
<td align="left">拒绝流入的流量，除非与流出的流量相关；而如果流量与ssh、mdns、ipp-client、amba-client与dhcpv6-client服务相关，则允许流量</td>
</tr>
<tr>
<td>internal</td>
<td align="left">等同于home区域</td>
</tr>
<tr>
<td>work</td>
<td align="left">拒绝流入的流量，除非与流出的流量相关；而如果流量与ssh、ipp-client与dhcpv6-client服务相关，则允许流量</td>
</tr>
<tr>
<td>public</td>
<td align="left">拒绝流入的流量，除非与流出的流量相关；而如果流量与ssh、dhcpv6-client服务相关，则允许流量</td>
</tr>
<tr>
<td>external</td>
<td align="left">拒绝流入的流量，除非与流出的流量相关；而如果流量与ssh服务相关，则允许流量</td>
</tr>
<tr>
<td>dmz</td>
<td align="left">拒绝流入的流量，除非与流出的流量相关；而如果流量与ssh服务相关，则允许流量</td>
</tr>
<tr>
<td>block</td>
<td align="left">拒绝流入的流量，除非与流出的流量相关</td>
</tr>
<tr>
<td>drop</td>
<td align="left">拒绝流入的流量，除非与流出的流量相关</td>
</tr>
</tbody></table>
<h2 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h2><p><strong>ps命令</strong> 用于报告当前系统的进程状态。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>-a</td>
<td>显示所有进程（包括其他用户的进程）</td>
</tr>
<tr>
<td>-u</td>
<td>用户以及其他详细信息</td>
</tr>
<tr>
<td>-x</td>
<td>显示没有控制终端的进程</td>
</tr>
</tbody></table>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加上ww可以完整展示进程的信息</span></span><br><span class="line">ps -efww</span><br><span class="line"><span class="comment"># 找出占用内存资源最多的前 10 个进程</span></span><br><span class="line">ps -auxf | <span class="built_in">sort</span> -nr -k 4 | <span class="built_in">head</span> -10</span><br><span class="line"><span class="comment"># 找出占用cpu资源最多的前 10 个进程</span></span><br><span class="line">ps -auxf | <span class="built_in">sort</span> -nr -k 3 | <span class="built_in">head</span> -10 </span><br></pre></td></tr></table></figure>
<h2 id="journalctl"><a href="#journalctl" class="headerlink" title="journalctl"></a>journalctl</h2><p>检索 systemd 日志，是 CentOS 7 才有的工具</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看服务启动日志</span></span><br><span class="line">journalctl -u kubelet.service</span><br><span class="line">journalctl -u etcd.service -f -n 100 </span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果不知道服务名称，可以使用<code>systemctl list-units --type=service</code>命令来列出系统中的 systemd 服务。</p>
</blockquote>
<h2 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h2><p><strong>watch命令</strong> 以周期性的方式执行给定的指令，指令输出以全屏方式显示</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每隔60s查看主机内存的使用情况</span></span><br><span class="line">watch -d -n 60 <span class="string">&quot;free -h&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="rpm"><a href="#rpm" class="headerlink" title="rpm"></a>rpm</h2><p><strong>rpm命令</strong> 是RPM软件包的管理工具</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出所有安装过的包</span></span><br><span class="line">rpm -qa </span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装rpm软件包</span></span><br><span class="line">rpm -ivh your-package.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取rpm包中的文件安装路径</span></span><br><span class="line">rpm -ql nfs-utils-1.3.0-0.54.el7.x86_64 </span><br></pre></td></tr></table></figure>

<h2 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h2><p><strong>crontab命令</strong> 被用来提交和管理用户的需要周期性执行的任务</p>
<p>用户可以使用 crontab 工具来定制自己的计划任务。所有用户定义的crontab文件都被保存在<code>/var/spool/cron</code>目录中。其文件名与用户名一致。</p>
<p>crontab文件的含义：用户所建立的crontab文件中，每一行都代表一项任务，每行的每个字段代表一项设置，它的格式共分为六个字段，前五段是时间设定段，第六段是要执行的命令段，格式如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">minute   hour   day   month   week   command     顺序：分 时 日 月 周</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@master01 ~]# <span class="built_in">cat</span> /var/spool/cron/root</span><br><span class="line"><span class="comment">#Ansible: release free</span></span><br><span class="line">0 * * * * sh /opt/free.sh</span><br><span class="line"><span class="comment">#Ansible: disk check over 85% move vip</span></span><br><span class="line">0 * * * * sh /opt/diskcheck.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出该用户的定时任务</span></span><br><span class="line">[root@master01 ~]# crontab -l</span><br><span class="line"><span class="comment">#Ansible: release free</span></span><br><span class="line">0 * * * * sh /opt/free.sh</span><br><span class="line"><span class="comment">#Ansible: disk check over 85% move vip</span></span><br><span class="line">0 * * * * sh /opt/diskcheck.sh</span><br></pre></td></tr></table></figure>

<h1 id="进阶操作"><a href="#进阶操作" class="headerlink" title="进阶操作"></a>进阶操作</h1><h2 id="nohup"><a href="#nohup" class="headerlink" title="nohup"></a>nohup</h2><p><strong>nohup命令</strong> 可以将程序以忽略挂起信号的方式运行起来，被运行的程序的输出信息将不会显示到终端。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 后台运行脚本，stderr和stdout重定向输出到output.log</span></span><br><span class="line"><span class="built_in">nohup</span> sh install.sh &gt; output.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>

<h2 id="script"><a href="#script" class="headerlink" title="script"></a>script</h2><p><strong>script</strong> 用于在终端会话中，记录用户的所有操作和命令的输出信息。</p>
<p>使用命令<code>exit</code>或者快捷键<code>Ctrl + D</code>停止记录。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 静默模式记录</span></span><br><span class="line">script -q myfile</span><br></pre></td></tr></table></figure>

<h2 id="chattr"><a href="#chattr" class="headerlink" title="chattr"></a>chattr</h2><p><strong>chattr命令</strong> 用来改变文件属性。这些属性共有以下8种模式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">a：让文件或目录仅供附加用途；</span><br><span class="line">b：不更新文件或目录的最后存取时间；</span><br><span class="line">c：将文件或目录压缩后存放；</span><br><span class="line">d：将文件或目录排除在倾倒操作之外；</span><br><span class="line">i：不得任意更动文件或目录；</span><br><span class="line">s：保密性删除文件或目录；</span><br><span class="line">S：即时更新文件或目录；</span><br><span class="line">u：预防意外删除。</span><br><span class="line"></span><br><span class="line">+&lt;属性&gt;：开启文件或目录的该项属性；</span><br><span class="line">-&lt;属性&gt;：关闭文件或目录的该项属性；</span><br><span class="line">=&lt;属性&gt;：指定文件或目录的该项属性。</span><br></pre></td></tr></table></figure>

<p>用chattr命令防止系统中某个关键文件被修改：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chattr +i /etc/fstab</span><br></pre></td></tr></table></figure>

<p>然后试一下rm、mv、rename等命令操作于该文件，都是得到Operation not permitted的结果。</p>
<p>让某个文件只能往里面追加内容，不能删除，一些日志文件适用于这种操作：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chattr +a /var/log/ansible.log</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">liaoxb</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">94k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">1:25</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  





</body>
</html>
