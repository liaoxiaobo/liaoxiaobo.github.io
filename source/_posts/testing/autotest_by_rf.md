---
title: 自动化测试实战总结-Robot Framework
date: 2019-12-20
categories:
  - 测试自动化
tags:
  - Robot Framework
  - DevOps
---
自动化测试跟其它任何一种测试类型（比如异常测试、稳定性测试、性能测试等）都是类似的，它也是一种测试类型而已。在开展测试之前，我们首先必须要明确自动化测试的需求是什么，要解决什么样的问题。<!-- more -->

## 一、明确需求

核心需求：“自动化”代替“手动”，提高测试效率

核心理念：

1、明确自动化收益。即每完成一条自动化用例，就减少了一条手工用例的执行时间。

2、每次回归或上线验证必须执行的用例优先自动化，让自动化收益最大化

3、确保新增用例是稳定100%通过前提下才被增加至用例集

4、自动化不可能完全代替手动

5、不要让环境问题成为瓶颈

## 二、技术选型

1、首先要分析项目的架构和状况

2、对于后端的服务，它如果是纯粹以接口的形式提供给其它组件去调用，那可以采取“接口自动化”

3、对于Web产品，如果前后端都在测试的保障范围，而且前端页面相对比较稳定，可以考虑采用“UI自动化”

4、最后测试技术栈选择python还是java，必须考虑团队成员的语言偏好和熟练程度

## 三、自动化实施过程

### 实施目标

- 同一份代码可以在多个集群执行
- 各个集群的测试数据相互独立，不会互相影响
- 可以方便地与数据库进行交互
- 当用例执行出错时，有详细的日志帮助定位
- 较好的可维护性和集群扩展性

目前我跟的项目已经实现自动化的内容如下：

- 基于接口的场景回归自动化测试
- 编译部署过程自动化
- 接入CICD平台跑自动化冒烟测试

有计划未来要实现的自动化如下：

- 接入CR平台（代码变更分析平台）的自动化
- 对外/上线打包发布的自动化

### 具体工作

框架搭建时，主要用了以下工具：

- gitee：管理多分支代码
- Robot Framework：作为测试框架
- docker：打包测试脚本和python包依赖，构建测试镜像

配置数据管理

- 目前是把不同的测试集群信息放在wisecloud.yaml文件里管理，另外basedata.py文件管理其它配置数据。比如公共登录账号、harbor地址账号等。
- 配置读取：单独创建一个Rest类，并继承REST父类。get_baseurl实例方法会根据env_type变量值，去动态获取目标集群的访问地址、集群ip地址,并调用BuiltIn().set_global_variable方法去设为全局变量。供用例执行过程中使用

分层设计与解耦

- 用例、方法（关键字）、测试库分层

- 用例按模块划分成多个测试用例文件，集中放进测试套件Suites

- 方法按模块划分成多个资源文件，集中放进资源文件夹Resource

- 自定义创建测试库和方法，集中放进Library。以关键字的形式以供调用

  ```sh
  ├── Library
  │   ├── Basedata.py
  │   ├── Rest.py
  │   ├── ServiceAdd.py
  │   └── wisecloud.yaml
  ├── Resource
  │   ├── BackupRestore.robot
  │   ├── Common.robot
  │   ├── Configcenter.robot
  │   ├── Dashboard.robot
  │   ├── Monitor.robot
  │   ├── Orche_App.robot
  │   ├── Orche_Stack.robot
  │   ├── Resource_Manager.robot
  │   ├── Workflow.robot
  │   └── pipeline_workflow.robot
  ├── Suites
  │   ├── backuprestore.robot
  │   ├── configcenter.robot
  │   ├── dashboard.robot
  │   ├── ingress
  │   │   └── ingress.robot
  ```

### 改进与提升

- 用例并发执行，解决用例耗时问题
- 统一配置数据文件，放在资源文件夹里
- 单例模式，解决用例频繁依赖登录接口组装header的问题
- 解决一切脚本不稳定问题

## 四、自动化在研发阶段的应用

### 持续集成自动化测试

狭义的理解是每次开发提交代码，自动触发构建和测试。

但是在实际项目中并不是这样玩的，实际落地的CI测试可能是每日1次或者每周1次，这完全取决于产品形态和团队的研发流程而定。

### 作为开发冒烟的一部分（未完成）

目前已经跟开发达成一致，开发非常欢迎将自动化用例接入到开发环境，用于他们每次变更时的环境正确性验证，可以尽早帮助他们发现研发过程中出现的问题。并且在提测前，只有100%通过自动化测试才可以进行提测。

## 五、自动化在测试阶段的应用

### 版本提测后的自动化回归验收

在开发提测后，我会自动化地完成以下事情：

- 流水线拉取测试代码
- 构建测试镜像
- 执行自动化测试
- 查看测试结果报告

当自动化用例全部执行通过时，说明系统的核心功能回归没有问题，然后开始版本的细粒度功能的测试。

### 版本Bug修复后的回归验收

在测试过程中，开发肯定会经常修复bug重新提交代码，每次有代码重新提交时，我都可以自动编译部署pr镜像。

## 六、成效

已实现的成效如下

- 自动编译部署：测试过程中开发修复bug提交代码是非常频繁的，每次的手动编译部署可能都会耗费十几分钟，并且测试人员的关注点还不能离开。
- 自动化回归测试：以前一次回归测试，需要QA持续地投入超过30分钟。现在通过一键执行，程序会自动地执行，时间控制在5分钟以内。且QA可以将注意力放到其它事情上。

正在计划、可预见的成效：

- 自动打包发布：目前都是人工利用shell脚本retag&push版本镜像到发布仓库中，还必须把注意力投入其中去检查是否有遗漏。计划利用流水线job去做好这件事
